# CVE-2026-24882 Analysis: GnuPG tpm2daemon Stack Buffer Overflow

This document demonstrates the Azure Linux CVE Analysis skill with a real example.

---

## Step 1: Gather CVE Details

### NVD Information

```json
{
  "id": "CVE-2026-24882",
  "published": "2026-01-27T19:16:16.670",
  "description": "In GnuPG before 2.5.17, a stack-based buffer overflow exists in tpm2daemon during handling of the PKDECRYPT command for TPM-backed RSA and ECC keys.",
  "severity": "HIGH",
  "references": [
    "https://dev.gnupg.org/T8045",
    "https://www.openwall.com/lists/oss-security/2026/01/27/8"
  ]
}
```

### Key Points
- **Severity:** HIGH
- **Component:** tpm2daemon (TPM 2.0 support)
- **Attack:** Stack buffer overflow via oversized ciphertext
- **Upstream bug:** https://dev.gnupg.org/T8045
- **Fixed in:** GnuPG 2.5.17

---

## Step 2: OVAL Data

From `azurelinux-3.0-oval.xml`:

```xml
<reference ref_id="CVE-2026-24882" source="CVE"/>
<patchable>true</patchable>
<advisory_date>2026-02-09T23:37:49Z</advisory_date>
<advisory_id>75266-1</advisory_id>
<severity>High</severity>
<description>CVE-2026-24882 affecting package gnupg2 for versions less than 2.4.9-2. 
A patched version of the package is available.</description>
```

### Key Findings
- **Package:** gnupg2
- **Vulnerable:** Versions < 2.4.9-2
- **Fixed version:** 2.4.9-2
- **Status:** Patchable (fix available)

---

## Step 3: RPM Spec Analysis

From `SPECS/gnupg2/gnupg2.spec`:

```spec
Name:           gnupg2
Version:        2.4.9
Release:        2%{?dist}

Patch0:         CVE-2026-24882.patch

%changelog
* Tue Feb 03 2026 Azure Linux Security Servicing Account <azurelinux-security@microsoft.com> - 2.4.9-2
- Patch for CVE-2026-24882
```

### Analysis
- **Base version:** 2.4.9 (released Jan 5, 2026)
- **Release bump:** 2.4.9-1 → 2.4.9-2
- **Remediation type:** **BACKPORT**
- **Patch file:** `CVE-2026-24882.patch`

---

## Step 4: Patch Content

From `SPECS/gnupg2/CVE-2026-24882.patch`:

```diff
From b23aa406f96b773fc2c8cc2cf63451f59a435350 Mon Sep 17 00:00:00 2001
From: Werner Koch <wk@gnupg.org>
Date: Mon, 26 Jan 2026 11:13:44 +0100
Subject: [PATCH] tpm: Fix possible buffer overflow in PKDECRYPT

* tpm2d/tpm2.c (tpm2_ecc_decrypt): Bail out on too long CIPHERTEXT.
(tpm2_rsa_decrypt): Ditto.
--

GnuPG-bug-id: 8045
Co-authored-by: NIIBE Yutaka <gniibe@fsij.org>
Reported-by: OpenAI Security Research
Upstream-reference: https://github.com/gpg/gnupg/commit/93fa34d9a346.patch
```

### Fix Details

The patch adds bounds checking for ciphertext length in two functions:

**tpm2_ecc_decrypt():**
```c
+#if defined(TPM2_MAX_ECC_KEY_BYTES) /* Intel stack */
+  if (ciphertext_len > 2*TPM2_MAX_ECC_KEY_BYTES + 1)
+    return GPG_ERR_TOO_LARGE;
+#elif defined(MAX_ECC_KEY_BYTES)    /* IBM stack */
+  if (ciphertext_len > 2*MAX_ECC_KEY_BYTES + 1)
+    return GPG_ERR_TOO_LARGE;
```

**tpm2_rsa_decrypt():**
```c
+#if defined(TPM2_MAX_RSA_KEY_BYTES)  /* Intel stack */
+  if (ciphertext_len > TPM2_MAX_RSA_KEY_BYTES)
+    return GPG_ERR_TOO_LARGE;
+#elif defined(MAX_RSA_KEY_BYTES)     /* IBM stack */
+  if (ciphertext_len > MAX_RSA_KEY_BYTES)
+    return GPG_ERR_TOO_LARGE;
```

---

## Step 5: Summary

| Field | Value |
|-------|-------|
| **CVE ID** | CVE-2026-24882 |
| **Affected Package** | gnupg2 |
| **Severity** | HIGH |
| **Azure Linux Status** | ✅ **FIXED** |
| **Remediation Type** | **Backport** |
| **Vulnerable Versions** | < 2.4.9-2 |
| **Fixed Version** | 2.4.9-2 |
| **Upstream Fix** | GnuPG 2.5.17 |
| **Fix Mechanism** | Cherry-picked commit from Werner Koch applied as Patch0 |
| **Component** | tpm2d/tpm2.c (TPM 2.0 daemon) |

---

## Why Backport Instead of Upgrade?

Azure Linux 3.0 uses GnuPG 2.4.x series, while the upstream fix was released in 2.5.17. Upgrading would mean:

1. **Major version jump:** 2.4.9 → 2.5.17 introduces many non-security changes
2. **Risk of regressions:** New features could break existing functionality
3. **Testing burden:** Full regression testing required for major upgrades

Instead, the security team extracted the specific fix (21 lines of code) and applied it to the stable 2.4.9 base, minimizing risk while addressing the vulnerability.

---

## Verification

Users can verify the fix is installed:

```bash
rpm -q gnupg2
# Expected: gnupg2-2.4.9-2.azl3 or later

rpm -q --changelog gnupg2 | head -5
# Should show: "Patch for CVE-2026-24882"
```

---

## Timeline

| Date | Event |
|------|-------|
| 2026-01-26 | Werner Koch commits fix upstream |
| 2026-01-27 | CVE-2026-24882 published in NVD |
| 2026-02-03 | Azure Linux patches gnupg2 (2.4.9-2) |
| 2026-02-09 | OVAL advisory published |
